# 实验二 译码器和编码器

查找8-3优先编码器相关原理和实现方法，实现一个8-3编码器，完成8-3编码器的设计、功能仿真和硬件实现。

这个硬件实现我们应该怎么做？一般来说像之前是使用verilator+nvboard来实现的，现在的话我考虑用FPGA在比较低的频率下通过串口上传数据到电脑再通过上位机解析来实现虚拟外设但真实电路的效果。

## 讨论

### BSV中组合逻辑的实现方式

在实现8-3优先编码器时，我们遇到了两种主要的实现方式：

#### 1. if-else 优先级实现
```bsv
if (unpack(input_data[7])) return 3'b111;
else if (unpack(input_data[6])) return 3'b110;
// ... 其他条件
```

**生成的硬件特点**：
- 形成嵌套的条件选择器（类似Verilog中的嵌套三元运算符）
- **不等延迟**：从input_data[0]到输出需要经过7级逻辑
- 真正体现"优先级"概念，高位优先
- 适合需要优先级逻辑的场合

#### 2. case 并行选择实现
对比多路选择器的case实现：
```bsv
case (sel)
    2'b00: return a;
    2'b01: return b;
    // ...
endcase
```

**生成的硬件特点**：
- 标准的多路选择器结构
- **等延迟**：所有输入到输出路径延迟相同
- 并行选择结构，所有分支地位相等
- 适合真正的多路选择场合

### 时序路径和面积分析

**时序特性对比**：
- **case语句**：所有输入到输出的路径延迟相等，时序可预测
- **if-else语句**：不同输入的路径延迟不相等，存在关键路径

**面积对比**：
- **case语句**：生成标准MUX单元，面积相对固定
- **if-else语句**：生成嵌套条件选择器，可能需要更多逻辑门

### 设计选择原则

**使用case语句当**：
- 需要等延迟的多路选择
- 所有分支同等重要
- 追求可预测的时序性能

**使用if-else语句当**：
- 真正需要优先级逻辑
- 某些条件比其他条件更频繁
- 可以接受不等延迟特性

### 关于casex的说明

在Verilog中，`casex`语句提供了类似if-else的优先级匹配功能，支持通配符（x/z），按书写顺序进行优先级匹配。`casex`在某种程度上等效于if-else的优先级逻辑，但BSV语言不支持casex语法（但存在case matches语法）。

对于8-3优先编码器这种典型的优先级电路，if-else实现更符合其"优先级"的本质含义，虽然会产生不等延迟，但这正是优先编码器的预期行为。

### 类型转换要点

在BSV中实现条件判断时需要注意：
- `input_data[7]`返回`Bit#(1)`类型
- `if`语句需要`Bool`类型条件
- 使用`unpack()`函数进行`Bit#(1)`到`Bool`的转换
- 也可以使用比较操作：`input_data[7] == 1'b1`